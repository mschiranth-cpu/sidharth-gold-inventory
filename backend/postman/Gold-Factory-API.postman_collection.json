{
  "info": {
    "name": "Gold Factory Inventory API",
    "description": "Complete API collection for Gold Factory Inventory System",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000/api",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Check if token exists and is not expired",
          "const accessToken = pm.collectionVariables.get('accessToken');",
          "if (accessToken) {",
          "    try {",
          "        const payload = JSON.parse(atob(accessToken.split('.')[1]));",
          "        const exp = payload.exp * 1000;",
          "        if (Date.now() >= exp - 60000) {",
          "            console.log('Token expired or expiring soon, refreshing...');",
          "            // Token refresh logic would go here",
          "        }",
          "    } catch (e) {",
          "        console.log('Error checking token:', e);",
          "    }",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has tokens', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('accessToken');",
                  "    pm.expect(jsonData).to.have.property('user');",
                  "    ",
                  "    // Save tokens",
                  "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                  "    if (jsonData.refreshToken) {",
                  "        pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"admin@goldfactory.com\",\n    \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Authenticate user and receive JWT tokens.\n\n**Example cURL:**\n```bash\ncurl -X POST http://localhost:5000/api/auth/login \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"email\": \"admin@goldfactory.com\", \"password\": \"password123\"}'\n```\n\n**Example JavaScript:**\n```javascript\nconst response = await fetch('/api/auth/login', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ email: 'admin@goldfactory.com', password: 'password123' })\n});\nconst { accessToken, user } = await response.json();\n```"
          }
        },
        {
          "name": "Register",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"newuser@example.com\",\n    \"password\": \"SecurePass123!\",\n    \"name\": \"New User\",\n    \"role\": \"WORKER\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "Get Current User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            }
          }
        },
        {
          "name": "Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.collectionVariables.set('accessToken', '');",
                  "pm.collectionVariables.set('refreshToken', '');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Get All Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is array or paginated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('object');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/users?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["users"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" }
              ]
            }
          }
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/users/:id",
              "host": ["{{baseUrl}}"],
              "path": ["users", ":id"],
              "variable": [
                { "key": "id", "value": "user-uuid-here" }
              ]
            }
          }
        },
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"worker@goldfactory.com\",\n    \"password\": \"SecurePass123!\",\n    \"name\": \"Factory Worker\",\n    \"role\": \"WORKER\",\n    \"departmentId\": \"department-uuid\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            }
          }
        },
        {
          "name": "Update User",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"Updated Name\",\n    \"role\": \"MANAGER\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/:id",
              "host": ["{{baseUrl}}"],
              "path": ["users", ":id"],
              "variable": [
                { "key": "id", "value": "user-uuid-here" }
              ]
            }
          }
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/users/:id",
              "host": ["{{baseUrl}}"],
              "path": ["users", ":id"],
              "variable": [
                { "key": "id", "value": "user-uuid-here" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Orders",
      "item": [
        {
          "name": "Get All Orders",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has pagination', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "    pm.expect(jsonData).to.have.property('pagination');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders?page=1&limit=10&status=IN_PROGRESS",
              "host": ["{{baseUrl}}"],
              "path": ["orders"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" },
                { "key": "status", "value": "IN_PROGRESS" },
                { "key": "priority", "value": "", "disabled": true },
                { "key": "search", "value": "", "disabled": true }
              ]
            },
            "description": "Get paginated orders with filtering.\n\n**cURL:**\n```bash\ncurl -X GET 'http://localhost:5000/api/orders?page=1&limit=10&status=IN_PROGRESS' \\\n  -H 'Authorization: Bearer YOUR_TOKEN'\n```"
          }
        },
        {
          "name": "Get Order by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/orders/:id",
              "host": ["{{baseUrl}}"],
              "path": ["orders", ":id"],
              "variable": [
                { "key": "id", "value": "order-uuid-here" }
              ]
            }
          }
        },
        {
          "name": "Create Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Order created with ID', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('orderNumber');",
                  "    pm.collectionVariables.set('lastOrderId', jsonData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"customerName\": \"ABC Jewelers\",\n    \"product\": \"Gold Necklace 22K\",\n    \"quantity\": 5,\n    \"goldWeight\": 45.5,\n    \"purity\": \"22K\",\n    \"priority\": \"HIGH\",\n    \"dueDate\": \"2024-02-15T00:00:00Z\",\n    \"notes\": \"Rush order - VIP customer\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Create a new order.\n\n**cURL:**\n```bash\ncurl -X POST http://localhost:5000/api/orders \\\n  -H 'Authorization: Bearer YOUR_TOKEN' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"customerName\": \"ABC Jewelers\",\n    \"product\": \"Gold Necklace 22K\",\n    \"quantity\": 5,\n    \"goldWeight\": 45.5,\n    \"purity\": \"22K\",\n    \"priority\": \"HIGH\",\n    \"dueDate\": \"2024-02-15T00:00:00Z\"\n  }'\n```\n\n**JavaScript:**\n```javascript\nconst order = await fetch('/api/orders', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${token}`,\n    'Content-Type': 'application/json'\n  },\n  body: JSON.stringify({\n    customerName: 'ABC Jewelers',\n    product: 'Gold Necklace 22K',\n    quantity: 5,\n    goldWeight: 45.5,\n    purity: '22K',\n    priority: 'HIGH',\n    dueDate: '2024-02-15T00:00:00Z'\n  })\n}).then(r => r.json());\n```"
          }
        },
        {
          "name": "Update Order",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"IN_PROGRESS\",\n    \"priority\": \"URGENT\",\n    \"notes\": \"Updated notes\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/:id",
              "host": ["{{baseUrl}}"],
              "path": ["orders", ":id"],
              "variable": [
                { "key": "id", "value": "{{lastOrderId}}" }
              ]
            }
          }
        },
        {
          "name": "Move Order to Department",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"departmentId\": \"department-uuid\",\n    \"notes\": \"Moving to next stage\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders/:id/move",
              "host": ["{{baseUrl}}"],
              "path": ["orders", ":id", "move"],
              "variable": [
                { "key": "id", "value": "{{lastOrderId}}" }
              ]
            }
          }
        },
        {
          "name": "Delete Order",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/orders/:id",
              "host": ["{{baseUrl}}"],
              "path": ["orders", ":id"],
              "variable": [
                { "key": "id", "value": "order-uuid-here" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Departments",
      "item": [
        {
          "name": "Get All Departments",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/departments",
              "host": ["{{baseUrl}}"],
              "path": ["departments"]
            }
          }
        },
        {
          "name": "Create Department",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"Quality Check\",\n    \"description\": \"Final quality inspection\",\n    \"sequence\": 5\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/departments",
              "host": ["{{baseUrl}}"],
              "path": ["departments"]
            }
          }
        }
      ]
    },
    {
      "name": "Factory",
      "item": [
        {
          "name": "Get Kanban Board",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/factory/kanban",
              "host": ["{{baseUrl}}"],
              "path": ["factory", "kanban"]
            }
          }
        },
        {
          "name": "Get Inventory",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/factory/inventory",
              "host": ["{{baseUrl}}"],
              "path": ["factory", "inventory"]
            }
          }
        }
      ]
    },
    {
      "name": "Notifications",
      "item": [
        {
          "name": "Get Notifications",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/notifications?unreadOnly=true",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                { "key": "unreadOnly", "value": "true" }
              ]
            }
          }
        },
        {
          "name": "Mark as Read",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{baseUrl}}/notifications/:id/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", ":id", "read"],
              "variable": [
                { "key": "id", "value": "notification-id" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Reports",
      "item": [
        {
          "name": "Dashboard Stats",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/reports/dashboard",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "dashboard"]
            }
          }
        },
        {
          "name": "Orders Report",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/reports/orders?startDate=2024-01-01&endDate=2024-01-31&format=json",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "orders"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-01-31" },
                { "key": "format", "value": "json" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            }
          }
        }
      ]
    }
  ]
}
